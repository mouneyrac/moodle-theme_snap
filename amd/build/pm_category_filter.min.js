define(["jquery","core/log","core/ajax","core/notification"],function(a,b,c,d){var e=function(){var b=this;this.viewingMode=function(b){c.call([{methodname:"theme_snap_user_viewing_mode",args:{value:b},done:function(c){"get"==b&&"categories"==c.value&&(a(".courseinfo").css("display","none"),j())},fail:function(a){d.exception(a)}}],!0,!0)};var e=function(b,e){c.call([{methodname:"theme_snap_user_categories",args:{action:b,categoryid:e},done:function(b){var c={};a(".pushy-content ul li").each(function(b){c[a(this).find("input").attr("selected-categoryid")]=a(this).attr("aria-checked")});var d="",e=JSON.parse(b.listing),g=!0;e.forEach(function(b,e){"false"===c[b]&&(a("[data-categoryid="+b+"]").css("display","inline"),a("[selected-categoryid="+b+"]").prop("checked",!0),a("#menu_mycategory_li_"+b).attr("aria-checked","true")),g?g=!1:d+=", ";var f="#menu_mycategory_"+b;d+=a(f).attr("value")});for(var h in c)e.indexOf(parseInt(h))==-1&&(a("[data-categoryid="+h+"]").css("display","none"),"true"===c[h]&&(a("[selected-categoryid="+h+"]").prop("checked",!1),a("#menu_mycategory_li_"+h).attr("aria-checked","false")));0==e.length&&"none"==a(".site-overlay").css("display")&&a(".snap_pm_editcat").click(),f.text("Categories"),""==d&&(d="No categories selected"),a(".snap_pm_user_category_list").text(d),a(".snap_pm_editcat").css("visibility","visible")},fail:function(a){d.exception(a)}}],!0,!0)},f=a("section#fixy-my-courses div h2"),g=function(a){var b=a.find("input");b.is(":checked")?e("remove",b.attr("selected-categoryid")):e("add",b.attr("selected-categoryid"))},h=function(b){g(a(this)),b.stopPropagation(),b.preventDefault()};a(".snap_pm_menu_mycategory_li").click(h),a(".snap_pm_menu_mycategory_li").keypress(function(){13!=event.which&&32!=event.which||g(a(this))}),f.text("All courses");var i=function(){f.text("All Courses"),a(".snap_pm_editcat").css("visibility","hidden"),a(".snap_pm_courses_section_title .snap_pm_category_filter_title").css("display","none"),a(".courseinfo").css("display","inline-block"),f.text("All courses"),a(".snap_pm_user_category_list").css("display","none"),a(".snap_pm_catfilter").removeClass("theme_snap_pm_active_link"),a(".snap_pm_allcourses").addClass("theme_snap_pm_active_link"),b.viewingMode("all")};a(".snap_pm_allcourses").click(i),a(".snap_pm_allcourses").keypress(function(){13!=event.which&&32!=event.which||i()});var j=function(){f.text("Categories"),e("listing"),a(".snap_pm_catfilter").addClass("theme_snap_pm_active_link"),a(".snap_pm_user_category_list").css("display","inline-block"),a(".snap_pm_allcourses").removeClass("theme_snap_pm_active_link"),a(".snap_pm_courses_section_title .snap_pm_category_filter_title").css("display","block"),b.viewingMode("categories")};a(".snap_pm_catfilter").click(j),a(".snap_pm_catfilter").keypress(function(){13!=event.which&&32!=event.which||j()});var k=function(){"true"==a(".snap_pm_editcat").attr("aria-expanded")?a(".snap_pm_editcat").attr("aria-expanded","false"):a(".snap_pm_editcat").attr("aria-expanded","true")};a(".snap_pm_editcat").click(k),a(".snap_pm_editcat").keypress(function(){}),a(".pushy-content ul li:last-child").keydown(function(){9==event.which&&"true"==a(".snap_pm_editcat").attr("aria-expanded")&&a(".pushy-content").focus()}),a("body").keydown(function(){27==event.which&&"true"==a(".snap_pm_editcat").attr("aria-expanded")&&a(".snap_pm_editcat").attr("aria-expanded","false")}),a(".site-overlay").click(function(){a(".snap_pm_editcat").attr("aria-expanded","false")}),a(".pushy-close-icon").click(function(){a(".site-overlay").click()}),a("#fixy-logout").length&&(b.viewingMode("get"),a(".snap_pm_courses_section_title .snap_pm_category_filter_title").css("display","none"))};return new e});