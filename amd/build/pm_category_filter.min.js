define(["jquery","core/log","core/ajax","core/notification"],function(a,b,c,d){var e=function(){var b=function(a){c.call([{methodname:"theme_snap_user_viewing_mode",args:{value:a},done:function(b){"get"==a&&"categories"==b.value&&j()},fail:function(a){d.exception(a)}}],!0,!0)},e=function(b,e){c.call([{methodname:"theme_snap_user_categories",args:{action:b,categoryid:e},done:function(b){a(".courseinfo").css("display","none"),a(".menu_mycategory").prop("checked",!1);var c="",d=JSON.parse(b.listing);if(0==d.length)"none"==a(".site-overlay").css("display")&&a(".editcat").click();else{var e=!0;d.forEach(function(b,d){a("[data-categoryid="+b+"]").css("display","inline"),a("[selected-categoryid="+b+"]").prop("checked",!0),a("#menu_mycategory_li_"+b).attr("aria-checked","true"),e?e=!1:c+=", ";var f="#menu_mycategory_"+b;c+=a(f).attr("value")})}f.text("Categories"),""==c&&(c="No categories selected"),a(".user_category_list").text(c),a(".editcat").css("visibility","visible")},fail:function(a){d.exception(a)}}],!0,!0)},f=a("section#fixy-my-courses div h2"),g=function(a){var b=a.find("input");b.is(":checked")?(b.prop("checked",!1),e("remove",b.attr("selected-categoryid"))):(b.prop("checked",!0),e("add",b.attr("selected-categoryid")))},h=function(){g(a(this))};a(".menu_mycategory_li").click(h),a(".menu_mycategory_li").keypress(function(){(13==event.which||32==event.which)&&g(a(this))}),f.text("All courses");var i=function(){f.text("All Courses"),a(".editcat").css("visibility","hidden"),a(".courseinfo").css("display","inline-block"),f.text("All courses"),a(".user_category_list").css("display","none"),a(".catfilter").css("display","inline"),a(".allcourses").css("display","none"),b("all")};a(".allcourses").click(i),a(".allcourses").keypress(function(){(13==event.which||32==event.which)&&i()});var j=function(){f.text("Categories"),e("listing"),a(".catfilter").css("display","none"),a(".user_category_list").css("display","inline-block"),a(".allcourses").css("display","inline"),b("categories")};a(".catfilter").click(j),a(".catfilter").keypress(function(){(13==event.which||32==event.which)&&j()});var k=function(){"true"==a(".editcat").attr("aria-expanded")?a(".editcat").attr("aria-expanded","false"):a(".editcat").attr("aria-expanded","true")};a(".editcat").click(k),a(".editcat").keypress(function(){}),a(".editcat").keydown(function(){9==event.which&&"true"==a(".editcat").attr("aria-expanded")&&a(".pushy-content").focus()}),a("body").keydown(function(){27==event.which&&"true"==a(".editcat").attr("aria-expanded")&&a(".editcat").attr("aria-expanded","false")}),a(".site-overlay").click(function(){a(".editcat").attr("aria-expanded","false")}),a(".pushy-close-icon").click(function(){a(".site-overlay").click()}),a("#fixy-logout").length&&b("get")};return new e});