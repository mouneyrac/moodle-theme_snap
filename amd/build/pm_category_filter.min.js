define(["jquery","core/log","core/ajax","core/notification"],function(a,b,c,d){var e=function(){var b=function(a){c.call([{methodname:"theme_snap_user_viewing_mode",args:{value:a},done:function(b){"get"==a&&"categories"==b.value&&j()},fail:function(a){d.exception(a)}}],!0,!0)},e=function(b,e){c.call([{methodname:"theme_snap_user_categories",args:{action:b,categoryid:e},done:function(b){var c={};a(".pushy-content ul li").each(function(b){c[a(this).find("input").attr("selected-categoryid")]=a(this).attr("aria-checked")});var d="",e=JSON.parse(b.listing);console.log(e);var g=!0;e.forEach(function(b,e){"false"===c[b]&&(a("[data-categoryid="+b+"]").css("display","inline"),a("[selected-categoryid="+b+"]").prop("checked",!0),a("#menu_mycategory_li_"+b).attr("aria-checked","true")),g?g=!1:d+=", ";var f="#menu_mycategory_"+b;d+=a(f).attr("value")});for(var h in c)-1==e.indexOf(parseInt(h))&&(a("[data-categoryid="+h+"]").css("display","none"),"true"===c[h]&&(a("[selected-categoryid="+h+"]").prop("checked",!1),a("#menu_mycategory_li_"+h).attr("aria-checked","false")));0==e.length&&"none"==a(".site-overlay").css("display")&&a(".editcat").click(),f.text("Categories"),""==d&&(d="No categories selected"),a(".user_category_list").text(d),a(".editcat").css("visibility","visible")},fail:function(a){d.exception(a)}}],!0,!0)},f=a("section#fixy-my-courses div h2"),g=function(a){var b=a.find("input");b.is(":checked")?e("remove",b.attr("selected-categoryid")):e("add",b.attr("selected-categoryid"))},h=function(b){g(a(this)),b.stopPropagation(),b.preventDefault()};a(".menu_mycategory_li").click(h),a(".menu_mycategory_li").keypress(function(){(13==event.which||32==event.which)&&g(a(this))}),f.text("All courses");var i=function(){f.text("All Courses"),a(".editcat").css("visibility","hidden"),a(".snap_pm_courses_section_title .snap_pm_category_filter_title").css("display","none"),a(".courseinfo").css("display","inline-block"),f.text("All courses"),a(".user_category_list").css("display","none"),a(".catfilter").removeClass("theme_snap_pm_active_link"),a(".allcourses").addClass("theme_snap_pm_active_link"),b("all")};a(".allcourses").click(i),a(".allcourses").keypress(function(){(13==event.which||32==event.which)&&i()});var j=function(){f.text("Categories"),e("listing"),a(".catfilter").addClass("theme_snap_pm_active_link"),a(".user_category_list").css("display","inline-block"),a(".allcourses").removeClass("theme_snap_pm_active_link"),a(".snap_pm_courses_section_title .snap_pm_category_filter_title").css("display","block"),b("categories")};a(".catfilter").click(j),a(".catfilter").keypress(function(){(13==event.which||32==event.which)&&j()});var k=function(){"true"==a(".editcat").attr("aria-expanded")?a(".editcat").attr("aria-expanded","false"):a(".editcat").attr("aria-expanded","true")};a(".editcat").click(k),a(".editcat").keypress(function(){}),a(".pushy-content ul li:last-child").keydown(function(){9==event.which&&"true"==a(".editcat").attr("aria-expanded")&&a(".pushy-content").focus()}),a("body").keydown(function(){27==event.which&&"true"==a(".editcat").attr("aria-expanded")&&a(".editcat").attr("aria-expanded","false")}),a(".site-overlay").click(function(){a(".editcat").attr("aria-expanded","false")}),a(".pushy-close-icon").click(function(){a(".site-overlay").click()}),a("#fixy-logout").length&&(b("get"),a(".snap_pm_courses_section_title .snap_pm_category_filter_title").css("display","none"))};return new e});