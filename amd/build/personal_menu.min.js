define(["jquery","core/log","core/yui","theme_snap/pm_course_cards","theme_snap/when_true","theme_snap/pm_category_filter"],function(a,b,c,d,e,f){var g=function(){var d=this;this.update=function(){var d=!0;if("object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(f){d=!1}a("#primary-nav").focus(),a("#page, #moodle-footer, #js-personal-menu-trigger, #logo, .skiplinks").hide(0);var g=function(c){var e=a("#snap-personal-menu-"+c);if(a(e).length){var f=M.cfg.sesskey+"personal-menu-"+c;try{if(window.sessionStorage[f]){b.info("using locally stored "+c);var g=window.sessionStorage[f];a(e).html(g)}b.info("fetching "+c),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_"+c+"&contextid="+M.cfg.context,success:function(g){b.info("fetched "+c),d&&"undefined"!=typeof g.html&&(window.sessionStorage[f]=g.html),a(e).attr("data-content-loaded","1"),a(e).html(g.html)}})}catch(h){sessionStorage.clear(),b.error(h)}}};g("deadlines"),g("graded"),g("grading"),g("messages"),g("forumposts"),a("#snap-personal-menu-badges").length&&"undefined"==typeof M.snap_message_badge&&e(function(){return"undefined"!=typeof M.snap_message_badge},function(){M.snap_message_badge.init_overlay(c)},!0),a(document).trigger("snapUpdatePersonalMenu")};var f=function(){a(document).on("click",".js-personal-menu-trigger",function(b){a("body").toggleClass("snap-fixy-open"),a(".snap-fixy-open #primary-nav").is(":visible")&&d.update(),b.preventDefault()}),a(document).on("click","#fixy-mobile-menu a",function(b){var c=this.getAttribute("href"),d=a("#fixy-content section"),e=a(d).outerWidth(),f=a(c),g=a(".callstoaction section > div").index(f)+1,h=e*g,i=a(c).outerHeight()+100;"#fixy-my-courses"==c&&(h=0);var j=a(window).height();j>i&&(i=j),a("#fixy-content").animate({left:"-"+h+"px",height:i+"px"},"fast","swing",function(){}),b.preventDefault()}),a(document).on("click","#fixy-close",function(){a("#page, #moodle-footer, #js-personal-menu-trigger, #logo, .skiplinks").css("display","")})};f()};return new g});